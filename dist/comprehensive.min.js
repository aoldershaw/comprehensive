"use strict";function handleReference(r,e){for(var t=r.expr.split("."),n=e,o=0,a=t;o<a.length;o++){if(void 0===(n=n[a[o]]))return n}return n}function ltrim(r,e){return r.replace(new RegExp("^"+e+"+"),"")}function isFunction(r){return"function"==typeof r}function evaluateKeyExpression(r,e,t,n){return n?handleReference(r,t):isFunction(r)?r(e):r}function evaluateValueExpression(r,e,t,n){return n?handleReference(r,t):isFunction(r)?r(e):r}function parseRef(r){var e=FIELD_REGEX.exec(r);if(null==e)throw new Error("Invalid reference format");return{expr:e[0]}}function parseFieldName(r){var e;if("over"===r.substr(0,4))return"it";if(null!=(e=FOR_REGEX.exec(r)))return e[1];throw new Error("Invalid iteration operator. Expecting either 'for ... of' or 'over'")}function toObj(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n,o=ltrim(r[0].trim(),"{").trim(),a=0,i=1,u=0===o.length;if(u){if(null==(n=e[a++]))throw new Error("Expecting a key");o=r[i++].trim()}else n=parseRef(o),o=o.substr(n.expr.length).trim();if(":"!==o.charAt(0))throw new Error("Missing ':'");o=o.substr(1).trim();var f,s=0===o.length;if(s){if(!(f=e[a++]))throw new Error("Expecting a value");o=r[i++].trim()}else f=parseRef(o),o=o.substr(f.expr.length).trim();var l=parseFieldName(o),p={},c={},v=e[a];if(null==v||!Array.isArray(v))throw new Error("An invalid array was passed (provided "+v+")");for(var E=0,h=v;E<h.length;E++){var x=h[E];c[l]=x;var w=evaluateKeyExpression(n,x,c,!u);if("string"!=typeof w&&"number"!=typeof w)throw new Error("Key must be either a string or a number, not a(n) "+typeof w);p[w]=evaluateValueExpression(f,x,c,!s)}return p}function toObjSafe(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];try{return toObj.apply(void 0,[r].concat(e))}catch(r){return null}}Object.defineProperty(exports,"__esModule",{value:!0});var FOR_REGEX=/^for\s+([A-Za-z_\$][A-Za-z0-9-_\$]*)\s+of/,FIELD_REGEX=/^[A-Za-z_$][A-Za-z0-9-_$]*(?:\.[A-Za-z_$][A-Za-z0-9-_$]*)*/;exports.toObj=toObj,exports.toObjSafe=toObjSafe;
