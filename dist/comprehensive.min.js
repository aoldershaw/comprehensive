"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var c,r,w=/^for\s+([A-Za-z_\$][A-Za-z0-9-_\$]*(\s*,\s*[A-Za-z_\$][A-Za-z0-9-_\$]*)*)\s+(in|of)/,e=/^[A-Za-z_$][A-Za-z0-9-_$]*(?:\.[A-Za-z_$][A-Za-z0-9-_$]*)*/;function y(r,t,e){return t?function(n,r){if("in"===r.type&&1<n.parts.length)throw new Error("You cannot traverse the key "+n.parts[0]);var o=r.names.indexOf(n.parts[0]);if(o<0)throw new Error("Invalid field name "+n.parts[0]);var a=1<r.names.length;return function(r){for(var t=a?r[o]:r,e=1;e<n.parts.length;e++)if(void 0===(t=t[n.parts[e]]))return t;return t}}(r,e):"function"==typeof r?r:function(){return r}}function g(r){var t=e.exec(r);if(null==t)throw new Error("Invalid reference format");return{parts:t[0].split("."),expr:t[0]}}function p(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var n,o=function(r,t){for(var e=0,n=r.length;e<n&&r.charAt(e)===t;)e++;return r.substr(e)}(r[0].trim(),"{").trim(),a=0,i=1,f=0===o.length;if(f){if(null==(n=t[a++]))throw new Error("Expecting a key");o=r[i++].trim()}else n=g(o),o=o.substr(n.expr.length).trim();if(":"!==o.charAt(0))throw new Error("Missing ':'");var s,u=0===(o=o.substr(1).trim()).length;if(u){if(!(s=t[a++]))throw new Error("Expecting a value");o=r[i++].trim()}else s=g(o),o=o.substr(s.expr.length).trim();var l=function(r){var t;if("over"===r.substr(0,4))return{names:["it"],type:c.OF};if(null!=(t=w.exec(r))){var e=t[1].split(",").map(function(r){return r.trim()}),n=t[3];if(n===c.IN&&1<e.length)throw new Error("Cannot spread multiple fields with the 'in' operator");return{names:e,type:n}}throw new Error("Invalid iteration operator. Expecting either 'for ... of', 'for ... in', or 'over'")}(o),p=y(n,!f,l),h=y(s,!u,l),v=l.type===c.OF?t[a]:Object.keys(t[a]);if(null==v||!Array.isArray(v))throw new Error("An invalid array was passed (provided "+v+")");return{keyFn:p,valueFn:h,list:v}}function n(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var n={},o=p.apply(void 0,[r].concat(t)),a=o.keyFn,i=o.valueFn,f=0,s=o.list;f<s.length;f++){var u=s[f],l=a(u);if("string"!=typeof l&&"number"!=typeof l)throw new Error("Key must be either a string or a number, not a(n) "+typeof l);n[l]=i(u)}return n}(r=c||(c={})).OF="of",r.IN="in",exports.default=n,exports.toObjSafe=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];try{return n.apply(void 0,[r].concat(t))}catch(r){return null}};
