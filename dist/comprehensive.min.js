"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var d,r,A=/^for\s+([A-Za-z_\$][A-Za-z0-9-_\$]*(\s*,\s*[A-Za-z_\$][A-Za-z0-9-_\$]*)*)\s+(in|of)/,e=/^[A-Za-z_$][A-Za-z0-9-_$]*(?:\.[A-Za-z_$][A-Za-z0-9-_$]*)*/;function b(r,t,e){return t?function(n,r){if("in"===r.type&&1<n.parts.length)throw"You cannot traverse the key "+n.parts[0];var o=r.names.indexOf(n.parts[0]);if(o<0)throw new Error("Invalid field name "+n.parts[0]);var i=1<r.names.length;return function(r){for(var t=i?r[o]:r,e=1;e<n.parts.length;e++)if(void 0===(t=t[n.parts[e]]))return t;return t}}(r,e):"function"==typeof r?r:function(){return r}}function x(r){var t=e.exec(r);if(null==t)throw new Error("Invalid reference format");return{parts:t[0].split("."),expr:t[0]}}function n(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var n,o=function(r,t){for(var e=0,n=r.length;e<n&&r.charAt(e)===t;)e++;return r.substr(e)}(r[0].trim(),"{").trim(),i=0,a=1,s=0===o.length;if(s){if(null==(n=t[i++]))throw new Error("Expecting a key");o=r[a++].trim()}else n=x(o),o=o.substr(n.expr.length).trim();if(":"!==o.charAt(0))throw new Error("Missing ':'");var f,u=0===(o=o.substr(1).trim()).length;if(u){if(!(f=t[i++]))throw new Error("Expecting a value");o=r[a++].trim()}else f=x(o),o=o.substr(f.expr.length).trim();var l=function(r){var t;if("over"===r.substr(0,4))return{names:["it"],type:d.OF};if(null!=(t=A.exec(r))){var e=t[1].split(",").map(function(r){return r.trim()}),n=t[3];if(n===d.IN&&1<e.length)throw new Error("Cannot spread multiple fields with the 'in' operator");return{names:e,type:n}}throw new Error("Invalid iteration operator. Expecting either 'for ... of', 'for ... in', or 'over'")}(o),p=b(n,!s,l),h=b(f,!u,l),c={},v=l.type===d.OF?t[i]:Object.keys(t[i]);if(null==v||!Array.isArray(v))throw new Error("An invalid array was passed (provided "+v+")");for(var w=0,m=v;w<m.length;w++){var g=m[w],y=p(g);if("string"!=typeof y&&"number"!=typeof y)throw new Error("Key must be either a string or a number, not a(n) "+typeof y);c[y]=h(g)}return c}(r=d||(d={})).OF="of",r.IN="in",exports.toObj=n,exports.toObjSafe=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];try{return n.apply(void 0,[r].concat(t))}catch(r){return null}};
